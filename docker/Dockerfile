# https://docs.docker.com/compose/gettingstarted/
# instructions for building new image

# кожен імедж створюється поверх інших імеджів
# ми зараз будемо створювати новий імедж для нашої аппки, яка працює поверх пайтону 2.7
# тому ми наслідуємось від пайтон 2.7 імеджу
FROM python:2.7-alpine

# дефолтна директорія, у яку ми попадаємо якщо зайдемо у контейнер
# усі команди RUN які запускаються нижче, вони будуть запускатися в цій папці
# тобто це аналог cd /code
WORKDIR /code

# змінні середовища
ENV FLASK_APP app.py
ENV FLASK_RUN_HOST 0.0.0.0

# команди, які запускаються в консолі ізольовано в контейнері
RUN apk add --no-cache gcc musl-dev linux-headers

# команда COPY для того щоб скопіювати файл з локальної тачки в image
# можна написати COPY . . тоді скопіюються УСІ файли з поточної директорії.
# так робити НЕ ТРЕБА! Чому? бо тоді розмір image буде супер великий
COPY requirements.txt requirements.txt

# запуск команди всередині контейнеру
RUN pip install -r requirements.txt

# скопіюємо усі інші файли з поточної папки
COPY . .

# стартова команда,
# команда, яка запуститься коли ми запустимо контейнер
CMD ["flask", "run"]